float fSloMoSca
float fSloMoDur
ref rTrgt

let fSloMoSca := 0.5
let fSloMoDur := 3.0

SetEventHandlerAlt "OnStartCombat" (begin function {ref rTrt, ref rAtk}
	if rTrt
		if Player.GetDistance3D rTrt <= 3500 && GetPCDetectionState != 3 && player.IsSneaking
			PlaySoundFile "Data/sound/fx/AlertReaction/AlertSound.mp3" 1 0 0
			if ggtm == 1.0
				sgtm fSloMoSca
				let rTrgt := rTrt
				CallAfterSeconds (fSloMoDur*fSloMoSca) (begin function {}
					sgtm 1.0
				end)
			endif
		endif
	endif
end) 2::player

SetEventHandlerAlt "OnCombatEnd" (begin function {ref rTgt, ref rEdr}
	if rTrgt && rTgt
		CallAfterFrames 5 (begin function {}
			if rTrgt == rTgt && ggtm != 1.0 && GetPCDetectionState != 3
				sgtm 1.0
			endif
		end)
	endif
end)
